# 实现分布式缓存框架

## 分层缓存
1. 本地缓存，命中的话直接返回。
2. 没有命中时则需要查询分布式缓存，如 Redis 
3. 如果分布式缓存没有命中则需要回源到 Tomcat 在本地堆进行查询，命中之后异步写回 Redis 
4. 以上都没有命中那就只有从 DB 或者是数据源进行查询，并写回到 Redis 中。

## 缓存更新的原子性
多个进程同时写那很有可能出现脏数据，这时就会出现更新原子性的问题

解决：
1. 可以将多个 Tomcat 中的数据写入到 MQ 队列中，由消费者进行单线程更新缓存
2. 利用分布式锁，只有获取到锁进程才能写数据。

## 如何写缓存
1. 开启事务。
2. 写入 DB 。
3. 提交事务。
4. 写入缓存。

## 负载策略
1. 轮询机制
2. 一致哈希算法。

# 本地缓存

1. jvm缓存
2. guava 缓存库
3. ehcache
4. caffine

## jvm缓存

map,list存放数据

不足：
1. 只能显式的写入，清除数据
2. 不能按照一定的规则淘汰数据，如 LRU，LFU，FIFO 等。
3. 清除数据时的回调通知。
4. 其他一些定制功能等。

需要的功能：
1. 自动清除数据、
2. 多种清除算法、
3. 清除回调

## guava cache






























